# 🚀 Git部署 - 执行步骤

## ✅ 已完成的准备工作

- ✅ Git仓库已初始化
- ✅ 所有文件已提交
- ✅ 远程仓库已配置：https://github.com/newbee408/chat-app.git

---

## 📋 接下来的步骤

### 第1步：在GitHub创建仓库

1. **访问GitHub创建仓库页面**：
   https://github.com/new

2. **填写仓库信息**：
   - Repository name: `chat-app`
   - Description: `即时聊天应用 - 基于Node.js和Socket.IO`
   - 选择：**Public** (公开)
   - ⚠️ **不要勾选**任何初始化选项（README、.gitignore、license）

3. **点击绿色按钮**：`Create repository`

---

### 第2步：推送代码到GitHub

#### 方法A：使用PowerShell（推荐）

打开PowerShell，执行：

```powershell
cd "$HOME\Desktop\chat-app"
git push -u origin main
```

**首次推送会要求登录GitHub**：

- **如果弹出浏览器登录窗口**：
  - 在浏览器中登录GitHub
  - 授权Git Credential Manager
  - 返回PowerShell等待完成

- **如果要求输入用户名密码**：
  - Username: `newbee408`
  - Password: 需要使用 **Personal Access Token**（不是GitHub密码）

#### 如何获取Personal Access Token：

1. 访问：https://github.com/settings/tokens
2. 点击 `Generate new token` → `Generate new token (classic)`
3. 填写：
   - Note: `chat-app-deploy`
   - Expiration: `90 days`
   - 勾选权限：`repo` (全部勾选)
4. 点击底部 `Generate token`
5. **复制生成的token**（只显示一次，保存好）
6. 在PowerShell密码提示时粘贴这个token

---

### 第3步：验证推送成功

推送成功后，访问：
https://github.com/newbee408/chat-app

应该能看到所有文件！

---

### 第4步：在服务器上部署

#### 4.1 登录云服务商Web终端

根据你的云服务商，找到Web终端入口：

**阿里云**：
- 控制台 → 云服务器ECS → 实例列表
- 找到服务器，点击"远程连接"
- 选择"Workbench远程连接"

**腾讯云**：
- 控制台 → 云服务器
- 点击"登录"按钮

**AWS**：
- EC2 → Instances → Connect
- 选择"EC2 Instance Connect"

**其他**：
- 查找"远程连接"、"Web终端"、"控制台"

#### 4.2 执行部署命令

在Web终端中，**复制粘贴**以下命令（一次性执行）：

```bash
# 进入root目录
cd /root

# 克隆项目
git clone https://github.com/newbee408/chat-app.git

# 进入项目目录
cd chat-app

# 安装依赖
npm install --production

# 安装PM2（全局进程管理器）
npm install -g pm2

# 启动应用
pm2 start ecosystem.config.json

# 保存PM2配置
pm2 save

# 设置开机自启（会输出一条命令）
pm2 startup

# 开放防火墙
sudo ufw allow 8080/tcp

# 查看应用状态
pm2 status

# 查看日志
pm2 logs chat-app --lines 20

# 显示访问地址
echo ""
echo "=========================================="
echo "✅ 部署完成！"
echo "🌐 访问地址: http://38.123.103.120:8080"
echo "=========================================="
```

**注意**：`pm2 startup` 会输出一条类似这样的命令：
```bash
sudo env PATH=$PATH:/usr/bin pm2 startup systemd -u root --hp /root
```
**复制这条命令并执行它**。

---

### 第5步：配置云服务商安全组（重要！）

**必须开放8080端口，否则外网无法访问！**

#### 阿里云：
1. 控制台 → 云服务器ECS → 网络与安全 → 安全组
2. 点击"配置规则"
3. 入方向 → 手动添加：
   - 端口范围：`8080/8080`
   - 授权对象：`0.0.0.0/0`
   - 协议类型：`TCP`
4. 点击"保存"

#### 腾讯云：
1. 控制台 → 安全组
2. 修改规则 → 入站规则 → 添加规则
3. 填写：
   - 类型：自定义
   - 协议端口：`TCP:8080`
   - 来源：`0.0.0.0/0`
4. 完成

#### AWS：
1. EC2 → Security Groups
2. 选择安全组 → Inbound rules → Edit
3. Add rule:
   - Type: Custom TCP
   - Port: 8080
   - Source: 0.0.0.0/0
4. Save

#### 其他云服务商：
- 查找"安全组"、"防火墙规则"、"网络ACL"
- 添加入站规则：TCP 8080，来源 0.0.0.0/0

---

### 第6步：测试访问

打开浏览器访问：
```
http://38.123.103.120:8080
```

**成功标志**：
- ✅ 看到登录界面
- ✅ 输入昵称能进入聊天室
- ✅ 能发送消息
- ✅ 打开多个窗口能实时聊天

---

## 🔍 检查命令

如果无法访问，在服务器上执行这些命令检查：

```bash
# 检查PM2状态（应显示online）
pm2 status

# 查看应用日志
pm2 logs chat-app

# 检查端口监听（应显示8080被node进程监听）
netstat -tlnp | grep 8080

# 检查防火墙
sudo ufw status

# 测试本地访问
curl http://localhost:8080
```

---

## 🔄 以后如何更新代码？

### 在本地修改后：
```powershell
cd "$HOME\Desktop\chat-app"
git add .
git commit -m "更新说明"
git push
```

### 在服务器上更新：
```bash
cd /root/chat-app
git pull
npm install --production
pm2 restart chat-app
```

---

## ❌ 故障排查

### 问题1：GitHub推送失败

**错误**：`remote: Repository not found`

**解决**：
1. 确认已在GitHub创建仓库
2. 仓库名必须是 `chat-app`
3. 仓库必须是Public

---

### 问题2：服务器git clone失败

**错误**：`fatal: unable to access 'https://github.com/...'`

**解决**：
```bash
# 测试网络
ping github.com

# 如果不通，使用代理或换用Gitee
```

---

### 问题3：PM2显示错误状态

**状态**：`errored` 或 `stopped`

**解决**：
```bash
# 查看详细错误
pm2 logs chat-app

# 尝试直接运行看错误
cd /root/chat-app
node server.js
```

---

### 问题4：浏览器无法访问

**检查清单**：
- [ ] PM2状态是online？ → `pm2 status`
- [ ] 端口8080被监听？ → `netstat -tlnp | grep 8080`
- [ ] 服务器防火墙允许？ → `sudo ufw status`
- [ ] 云服务商安全组开放？ → 去控制台检查
- [ ] 本地能访问？ → `curl http://localhost:8080`

---

## 📞 需要帮助？

如果遇到问题，提供以下信息：

1. 在哪一步遇到问题？
2. 具体的错误信息是什么？
3. `pm2 status` 的输出
4. `pm2 logs chat-app` 的输出

---

## 🎉 部署成功后

恭喜！你已经成功部署了一个即时聊天应用！

**可以做的事**：
- 分享链接给朋友一起聊天
- 修改代码添加新功能
- 学习WebSocket实时通信原理
- 扩展功能：私聊、表情包、文件传输等

---

**准备好了吗？开始第1步：在GitHub创建仓库！**

创建完成后告诉我，我帮你推送代码！
