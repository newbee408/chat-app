# 📘 WinSCP连接云服务器完整教程

## 服务器信息
- **IP地址**: 38.123.103.120
- **用户名**: root
- **端口**: 22
- **认证方式**: SSH密钥（无密码）

---

## 第一步：下载和安装WinSCP

### 1. 下载WinSCP
- 官网下载: https://winscp.net/eng/download.php
- 选择 "Installation package" 下载
- 或者直接下载: https://winscp.net/download/WinSCP-6.3.5-Setup.exe

### 2. 安装WinSCP
- 双击安装包
- 选择 "典型安装"
- 一路点击 "下一步" 完成安装

---

## 第二步：找到你的SSH密钥文件

你提到"无密码"，说明使用SSH密钥登录。密钥文件可能在：

### 常见位置：
1. **云服务商下载的密钥**
   - 通常是 `.pem` 文件
   - 可能在：`下载` 文件夹
   - 文件名类似：`your-server-key.pem` 或 `id_rsa.pem`

2. **系统默认SSH密钥**
   - 位置：`C:\Users\你的用户名\.ssh\`
   - 文件名：`id_rsa`（私钥）或 `id_rsa.pub`（公钥）
   - **注意**：WinSCP需要私钥（没有.pub后缀的）

3. **PuTTY格式密钥**
   - 文件扩展名：`.ppk`

### 如何查找：
```
打开文件资源管理器，搜索：
- *.pem
- id_rsa
- *.ppk
```

---

## 第三步：转换密钥格式（如果需要）

WinSCP支持多种密钥格式，但如果是 `.pem` 文件，建议转换为 `.ppk` 格式。

### 使用PuTTYgen转换：

1. **下载PuTTYgen**
   - 下载地址: https://www.chiark.greenend.org.uk/~sgtatham/putty/latest.html
   - 或者WinSCP安装时已包含

2. **转换步骤**：
   - 打开 PuTTYgen
   - 点击 "Load" 按钮
   - 文件类型选择 "All Files (*.*)"
   - 选择你的 `.pem` 文件
   - 点击 "Save private key" 
   - 保存为 `.ppk` 文件（比如 `my-server-key.ppk`）

**注意**：如果你的密钥没有密码保护，会提示警告，点击"是"继续即可。

---

## 第四步：配置WinSCP连接

### 1. 打开WinSCP
启动WinSCP，会看到"登录"对话框

### 2. 基本配置
在左侧"会话"部分填写：

```
文件协议: SFTP
主机名: 38.123.103.120
端口号: 22
用户名: root
密码: (留空，不要填写)
```

### 3. 配置SSH密钥

点击右下角 **"高级"** 按钮：

1. 在左侧树形菜单中找到：
   ```
   SSH → 验证
   ```

2. 在右侧找到 **"私钥文件"** 选项

3. 点击右侧的 **"..."** 按钮浏览文件

4. 选择你的密钥文件：
   - 如果是 `.ppk` 文件，直接选择
   - 如果是 `.pem` 文件，文件类型选择 "All Files"，然后选择
   - WinSCP会自动提示转换格式

5. 点击 **"确定"** 返回主界面

### 4. 保存会话（可选但推荐）

1. 在左侧"会话"列表中，点击 **"新建站点"**
2. 输入一个名称，比如 "我的云服务器"
3. 点击 **"保存"**

### 5. 连接

点击 **"登录"** 按钮

---

## 第五步：首次连接

### 1. 信任主机密钥
首次连接会弹出警告：
```
警告 - 潜在的安全问题
服务器的主机密钥未缓存在注册表中...
```

- 点击 **"是(Y)"** 或 **"更新"** 继续
- 这是正常的安全提示

### 2. 连接成功
如果一切正常，你会看到：
- **左侧窗口**：你的本地电脑文件
- **右侧窗口**：服务器上的文件

---

## 第六步：上传chat-app项目

### 1. 准备本地文件
在左侧（本地）窗口：
- 导航到：`C:\Users\Administrator\Desktop\`
- 找到 `chat-app` 文件夹

### 2. 删除node_modules（重要！）
在上传前，先删除 `node_modules` 文件夹（如果存在）：
- 进入 `chat-app` 文件夹
- 找到 `node_modules` 文件夹
- 右键 → 删除
- **原因**：这个文件夹很大，会在服务器上重新安装

### 3. 导航到服务器目录
在右侧（服务器）窗口：
- 导航到 `/root` 目录
- 如果看不到，在地址栏输入：`/root` 然后回车

### 4. 上传文件夹
- 从左侧拖拽 `chat-app` 文件夹到右侧
- 或者：右键 `chat-app` → 上传
- 等待上传完成（会显示进度条）

---

## 第七步：打开SSH终端

### 方法1：在WinSCP中打开
- 点击顶部菜单：**命令(C)** → **打开终端(T)**
- 或按快捷键：**Ctrl + T**
- 会打开一个黑色的终端窗口

### 方法2：使用PuTTY
- 在WinSCP中，点击顶部工具栏的 **"PuTTY"** 图标
- 会自动打开PuTTY并连接到服务器

---

## 第八步：执行部署命令

在终端中粘贴以下命令（一次性复制粘贴）：

```bash
cd /root/chat-app && \
npm install --production && \
npm install -g pm2 && \
pm2 delete chat-app 2>/dev/null || true && \
pm2 start ecosystem.config.json && \
pm2 save && \
pm2 startup && \
sudo ufw allow 8080/tcp 2>/dev/null || true && \
echo "" && \
echo "========================================" && \
echo "✅ 部署完成！" && \
echo "🌐 访问地址: http://38.123.103.120:8080" && \
echo "========================================" && \
pm2 status
```

**粘贴方法**：
- 在终端窗口右键 → 粘贴
- 或按 Shift + Insert
- 然后按回车执行

---

## 🎯 成功标志

如果看到：
```
┌────┬────────────┬─────────────┬─────────┬─────────┬──────────┐
│ id │ name       │ mode        │ ↺       │ status  │ cpu      │
├────┼────────────┼─────────────┼─────────┼─────────┼──────────┤
│ 0  │ chat-app   │ fork        │ 0       │ online  │ 0%       │
└────┴────────────┴─────────────┴─────────┴─────────┴──────────┘
```

**status 显示 "online"** 就说明部署成功！

---

## ❌ 常见问题解决

### 问题1：找不到SSH密钥文件

**解决方案A：使用密码登录（临时）**
如果你知道root密码：
1. WinSCP配置中，密码栏填写密码
2. 高级 → SSH → 验证 → 私钥文件留空
3. 尝试连接

**解决方案B：从云服务商重新下载密钥**
1. 登录云服务商控制台
2. 找到你的服务器实例
3. 查找"密钥对"或"SSH密钥"选项
4. 重新下载或创建新密钥

**解决方案C：在服务器上创建新密钥**
如果你能通过其他方式登录服务器：
```bash
# 允许密码登录（临时）
sudo nano /etc/ssh/sshd_config
# 找到 PasswordAuthentication no
# 改为 PasswordAuthentication yes
# 保存后重启SSH
sudo systemctl restart sshd

# 设置root密码
sudo passwd root
```

### 问题2：连接超时

**检查项**：
- ✅ IP地址是否正确：38.123.103.120
- ✅ 端口是否正确：22
- ✅ 云服务商安全组是否开放22端口
- ✅ 网络是否正常

### 问题3：密钥被拒绝

**错误信息**：
```
Server refused our key
```

**解决方案**：
1. 确认使用的是私钥（不是.pub公钥）
2. 检查密钥文件权限
3. 尝试转换为.ppk格式
4. 联系云服务商确认密钥是否正确

### 问题4：权限被拒绝

**错误信息**：
```
Permission denied
```

**解决方案**：
1. 确认用户名是 `root`
2. 或尝试使用 `ubuntu` / `admin` 等用户名
3. 检查密钥是否匹配

---

## 📸 图文对照（关键步骤）

### WinSCP主界面配置
```
┌─────────────────────────────────────┐
│ 文件协议: [SFTP ▼]                  │
│ 主机名: [38.123.103.120]            │
│ 端口号: [22]                        │
│ 用户名: [root]                      │
│ 密码: [____________]  (留空)        │
│                                     │
│ [高级(A)...]  [保存(S)]  [登录(L)] │
└─────────────────────────────────────┘
```

### 高级设置 → SSH → 验证
```
┌─────────────────────────────────────┐
│ SSH                                 │
│ ├─ 验证 ◄─ 点这里                   │
│ ├─ KEX                              │
│ └─ ...                              │
│                                     │
│ 私钥文件:                           │
│ [C:\path\to\key.ppk] [...] ◄─ 点这里│
└─────────────────────────────────────┘
```

---

## 🎓 视频教程推荐

如果还是不清楚，可以搜索：
- "WinSCP使用教程"
- "WinSCP连接Linux服务器"
- "WinSCP SSH密钥登录"

---

## 📞 需要帮助？

如果遇到问题，告诉我：
1. 在哪一步卡住了？
2. 看到什么错误提示？
3. 是否找到了SSH密钥文件？
4. 云服务商是哪家？（阿里云/腾讯云/AWS等）

我会继续帮你解决！
